# 用d3绘制流程图



## 构思

- 流程图上的元素分为两大类，图形和线
- 将图形分为上下左右四个挂载点，用于添加连线

![四个挂载点](/static/img/docs_4_挂载点.jpg)

- 拖动图形上的挂载点引出导线
- 导线连接两个图形时，尽量不与图形相交

## 日志

### 3.28 连线的设计

将两个图形用方框圈住，方框的宽是两个图形相离最远的x轴方向的线的距离加上两倍的导线最短距离。方框的高是两个图形相离最远的y轴方向的线的距离加上两倍的导线最短距离。
根据两个图形的中心计算出中点，绘制x、y轴。

![方框](/static/img/docs_4_方框.jpg)

### 3.29 连线完成

## 代码结构

### html部分

总共分2部分，一部分为画板绘制svg，一部分为配置面板

### js部分

#### 基本节点数据结构

```javascript
{
    // 包含的文字
    text: '中间节点',
    // 类型
    type: 'rect',
    // x方向坐标
    x: 600,
    // y方向坐标
    y: 300,
    width: 100,
    height: 80,
    // 自动生成的id
    id: 1
}
```

#### 节点关联关系数据结构

```javascript
{
    // key值为`${id}-${方向}`
    '1-top': ['2-bottom'],
    // value值为`${id}-${方向}`的数组
    '1-right': ['5-left'],
    '1-bottom': ['3-top'],
    '1-left': ['4-right']
}
```

#### 流程

```flow
st=>start:Start
e=>end:End
st->e 
```

